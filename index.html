<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stick Jumper</title>
    <style>
        canvas {
            border: 1px solid white;
            max-width: 100%;
            height: auto;
            touch-action: none;
        }
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000000;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game variables
        let player = { x: 50, y: 350, vy: 0, jumping: false, onPlatform: false, frame: 0 };
        const gravity = 0.4;
        const jumpStrength = -10;
        let hearts = 3;
        let score = 0;
        let timeElapsed = 0;
        let scrollSpeed = 3;
        let gameOver = false;
        let lastScore = 0;
        let highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;
        let lastHeartSpawn = -15; // Track time since last special heart spawn (start negative to spawn at t=0)

        // Foreground objects
        let obstacles = [
            { type: 'spike', x: 300, y: 350 },
            { type: 'spike', x: 600, y: 350 }
        ];
        let coins = [
            { x: 250, y: 320 },
            { x: 450, y: 300 }
        ];
        let specialHearts = []; // New array for special hearts
        let platforms = [];

        // Background objects
        let mountains = [
            { x: 200, y: 350 },
            { x: 500, y: 350 }
        ];
        let trees = [
            { x: 300, y: 350 },
            { x: 700, y: 350 }
        ];

        // Input
        canvas.addEventListener('touchstart', handleTouch);
        document.addEventListener('keydown', handleKey);

        function handleTouch(e) {
            e.preventDefault();
            if (gameOver) {
                restartGame();
            } else if (!player.jumping) {
                player.vy = jumpStrength;
                player.jumping = true;
                player.onPlatform = false;
            }
        }

        function handleKey(e) {
            if (e.code === 'Space') {
                if (gameOver) {
                    restartGame();
                } else if (!player.jumping) {
                    player.vy = jumpStrength;
                    player.jumping = true;
                    player.onPlatform = false;
                }
            }
        }

        function restartGame() {
            player = { x: 50, y: 350, vy: 0, jumping: false, onPlatform: false, frame: 0 };
            hearts = 3;
            score = 0;
            timeElapsed = 0;
            scrollSpeed = 3;
            gameOver = false;
            lastHeartSpawn = -15; // Reset to spawn first heart immediately
            obstacles = [
                { type: 'spike', x: 300, y: 350 },
                { type: 'spike', x: 600, y: 350 }
            ];
            coins = [
                { x: 250, y: 320 },
                { x: 450, y: 300 }
            ];
            specialHearts = []; // Clear special hearts
            platforms = [];
            mountains = [
                { x: 200, y: 350 },
                { x: 500, y: 350 }
            ];
            trees = [
                { x: 300, y: 350 },
                { x: 700, y: 350 }
            ];
        }

        // Game loop
        function update() {
            // Player physics
            player.vy += gravity;
            player.y += player.vy;

            // Platform collision
            let onPlatform = false;
            platforms.forEach(p => {
                if (player.x + 15 > p.x && player.x < p.x + 60 &&
                    player.y + 15 > p.y && player.y + 15 < p.y + 10 &&
                    player.vy > 0) {
                    player.y = p.y - 15;
                    player.vy = 0;
                    player.jumping = false;
                    player.onPlatform = true;
                    onPlatform = true;
                }
            });
            if (!onPlatform && player.y > 350) {
                player.y = 350;
                player.vy = 0;
                player.jumping = false;
                player.onPlatform = false;
            }

            if (!gameOver) {
                // Animate walking
                if (!player.jumping) {
                    player.frame += 0.2;
                    if (player.frame > 2 * Math.PI) player.frame -= 2 * Math.PI;
                }

                // Scroll and speed increase
                timeElapsed += 1 / 60;
                if (timeElapsed % 10 < 0.017) {
                    scrollSpeed += 0.1;
                }
                obstacles.forEach(o => o.x -= scrollSpeed);
                coins.forEach(c => c.x -= scrollSpeed);
                specialHearts.forEach(h => h.x -= scrollSpeed); // Scroll special hearts
                platforms.forEach(p => p.x -= scrollSpeed);
                mountains.forEach(m => m.x -= scrollSpeed / 2);
                trees.forEach(t => t.x -= scrollSpeed / 2);

                // Spawn foreground objects
                if (Math.random() < 0.02) {
                    const newX = 800 + Math.random() * 200;
                    let minGap = scrollSpeed * 15;
                    let tooClose = false;
                    obstacles.forEach(o => {
                        if (Math.abs(o.x - newX) < minGap) {
                            tooClose = true;
                        }
                    });

                    obstacles​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​​
